<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_1xkv5yj" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Zeebe Modeler" exporterVersion="0.10.0">
  <bpmn:process id="ocr-service" name="OCR service" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_15okcgc</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:endEvent id="Event_1hdrdqi">
      <bpmn:incoming>Flow_1nct0gu</bpmn:incoming>
      <bpmn:incoming>Flow_0g6dlse</bpmn:incoming>
      <bpmn:incoming>Flow_1v6emu1</bpmn:incoming>
      <bpmn:incoming>Flow_1avo85z</bpmn:incoming>
      <bpmn:incoming>Flow_00ac2bd</bpmn:incoming>
      <bpmn:incoming>Flow_09g1wpu</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_1htx951" name="Request to check if KTP exists" default="Flow_1a92wah">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="generic-push-rabbit" retries="3" />
        <zeebe:taskHeaders>
          <zeebe:header key="adapter-zeebe-topic" value="request.document-uploader.check-document-existence" />
          <zeebe:header key="adapter-zeebe-brokers-host" value="asalite-amqp-host" />
          <zeebe:header key="adapter-zeebe-brokers-port" value="asalite-amqp-port" />
          <zeebe:header key="adapter-zeebe-brokers-user" value="asalite-amqp-user" />
          <zeebe:header key="adapter-zeebe-reply-to" value="zeebe.response.document-uploader" />
          <zeebe:header key="adapter-request-mapping" value="{&#34;body&#34;:{&#34;jsonClass&#34;:&#34;Request&#34;,&#34;headers&#34;:{&#34;Accept-Language&#34;:&#34;en&#34;},&#34;body&#34;:{&#34;jsonClass&#34;:&#34;CheckDocExistenceBody&#34;,&#34;customerId&#34;:&#34;$.customerId&#34;,&#34;docType&#34;:&#34;ID_KTP&#34;},&#34;replyTo&#34;:&#34;zeebe.response.document-uploader&#34;,&#34;routingKey&#34;:&#34;request.document-uploader.check-document-existence&#34;}}" />
          <zeebe:header key="adapter-zeebe-correlation-key" value="customerId" />
          <zeebe:header key="adapter-zeebe-mq-header" value="{&#34;Accept-Language&#34;:&#34;en&#34;}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_15okcgc</bpmn:incoming>
      <bpmn:outgoing>Flow_1a92wah</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:receiveTask id="Activity_0o5g52b" name="Received check KTP existence response" default="Flow_0tuaryi" messageRef="Message_0c66i66">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:output source="=body.exists" target="ktpPhotoExists" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1a92wah</bpmn:incoming>
      <bpmn:outgoing>Flow_0tuaryi</bpmn:outgoing>
    </bpmn:receiveTask>
    <bpmn:boundaryEvent id="Event_1iz4017" name="PT10M" attachedToRef="Activity_0o5g52b">
      <bpmn:outgoing>Flow_0ewrx13</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_04vfnmv">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT10M</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
    <bpmn:exclusiveGateway id="Gateway_1kbf9l8" name="KTP photo doesn&#39;t exist?" default="Flow_05bq5a6">
      <bpmn:incoming>Flow_0tuaryi</bpmn:incoming>
      <bpmn:outgoing>Flow_0zp68gp</bpmn:outgoing>
      <bpmn:outgoing>Flow_05bq5a6</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="Activity_0taxxf3" name="Update required docs" default="Flow_14kwi44">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="variables-set-handler" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestStatesList.WAITING_KTP" target="kycRequestState" />
          <zeebe:output source="= kycRequestMessagesList.WAITING_KTP" target="kycRequestMessage" />
          <zeebe:output source="= requiredDocs" target="requiredDocs" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="variables-data" value="{&#34;requiredDocs&#34;:[&#34;ID_KTP&#34;]}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0zp68gp</bpmn:incoming>
      <bpmn:outgoing>Flow_14kwi44</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0zp68gp" name="Yes" sourceRef="Gateway_1kbf9l8" targetRef="Activity_0taxxf3">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=ktpPhotoExists = false</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:receiveTask id="Activity_0emeo0q" name="KTP uploaded event" default="Flow_1r6aves" messageRef="Message_1ynv0n8">
      <bpmn:incoming>Flow_14kwi44</bpmn:incoming>
      <bpmn:outgoing>Flow_1r6aves</bpmn:outgoing>
    </bpmn:receiveTask>
    <bpmn:boundaryEvent id="Event_1fnb9n2" name="1d" attachedToRef="Activity_0emeo0q">
      <bpmn:outgoing>Flow_10kn3dm</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_0pe4fqa">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P1D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
    <bpmn:serviceTask id="Activity_12sr0ay" name="Update status to &#34;KTP_DOC_&#10;EXISTS&#34;" default="Flow_1t67r37">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="complete-type" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestStatesList.KTP_DOC_EXISTS" target="kycRequestState" />
          <zeebe:output source="= kycRequestMessagesList.KTP_DOC_EXISTS" target="kycRequestMessage" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="variables-data" value="{&#34;requiredDocs&#34;:&#34;&#34;}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_05bq5a6</bpmn:incoming>
      <bpmn:incoming>Flow_1r6aves</bpmn:incoming>
      <bpmn:outgoing>Flow_1t67r37</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_14kwi44" sourceRef="Activity_0taxxf3" targetRef="Activity_0emeo0q" />
    <bpmn:sequenceFlow id="Flow_05bq5a6" name="No" sourceRef="Gateway_1kbf9l8" targetRef="Activity_12sr0ay" />
    <bpmn:sequenceFlow id="Flow_1r6aves" sourceRef="Activity_0emeo0q" targetRef="Activity_12sr0ay" />
    <bpmn:serviceTask id="Activity_0klf8jq" name="Generate Fail Message">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="variables-set-handler" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestMessagesList.KTP_UPLOAD_EXPIRED" target="loanRequestMessage" />
          <zeebe:output source="= kycRequestStatesList.KTP_UPLOAD_EXPIRED" target="kycRequestState" />
          <zeebe:output source="= workflowFailed" target="workflowFailed" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="variables-data" value="{&#34;workflowFailed&#34;:true}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0ewrx13</bpmn:incoming>
      <bpmn:incoming>Flow_10kn3dm</bpmn:incoming>
      <bpmn:outgoing>Flow_1v6emu1</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_1qmrwwt" name="Request OCR data" default="Flow_0negztp">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="generic-push-rabbit" retries="1" />
        <zeebe:taskHeaders>
          <zeebe:header key="adapter-zeebe-topic" value="request.fdc-gateway.inquiryFdc" />
          <zeebe:header key="adapter-zeebe-brokers-host" value="asalite-amqp-host" />
          <zeebe:header key="adapter-zeebe-brokers-port" value="asalite-amqp-port" />
          <zeebe:header key="adapter-zeebe-brokers-user" value="asalite-amqp-user" />
          <zeebe:header key="adapter-zeebe-reply-to" value="zeebe.response.fdc" />
          <zeebe:header key="adapter-request-mapping" value="{    &#34;body&#34;:{       &#34;jsonClass&#34;:&#34;Request&#34;,       &#34;headers&#34;:{        },       &#34;body&#34;:{          &#34;jsonClass&#34;:&#34;InquiryFdcBody&#34;,          &#34;customerId&#34;:&#34;$.customerId&#34;,          &#34;ktp&#34;:&#34;$.application.mappedFieldGroupValues.personalInfo.mappedFieldValues.nik.fieldValue.value&#34;,          &#34;customerStatus&#34;:&#34;$.customerStatus&#34;       },       &#34;replyTo&#34;:&#34;zeebe.response.fdc&#34;,       &#34;routingKey&#34;:&#34;request.fdc-gateway.inquiryFdc&#34;    } }" />
          <zeebe:header key="adapter-zeebe-correlation-key" value="customerId" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0cmhw6r</bpmn:incoming>
      <bpmn:outgoing>Flow_0negztp</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:receiveTask id="Activity_1xv0l7k" name="Waiting OCR data" default="Flow_1r1runz" messageRef="Message_064frh3">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:output source="=data.idNumber" target="ocrKtpNumber" />
          <zeebe:output source="=data.name" target="ocrName" />
          <zeebe:output source="=data.bloodType" target="ocrBloodType" />
          <zeebe:output source="=data.religion" target="ocrReligion" />
          <zeebe:output source="=data.gender" target="ocrGender" />
          <zeebe:output source="=split(data.birthPlaceBirthday, &#34;,&#34;)" target="ocrBirthPlaceBirthdayList" />
          <zeebe:output source="=data.province" target="ocrProvince" />
          <zeebe:output source="=data.city" target="ocrCity" />
          <zeebe:output source="=data.district" target="ocrDistrict" />
          <zeebe:output source="=data.village" target="ocrVillage" />
          <zeebe:output source="=data.rtrw" target="ocrRtrw" />
          <zeebe:output source="=data.address" target="ocrAddress" />
          <zeebe:output source="=data.occupation" target="ocrOccupation" />
          <zeebe:output source="=data.expiryDate" target="ocrExpiryDate" />
          <zeebe:output source="=data.nationality" target="ocrNationality" />
          <zeebe:output source="=data.maritalStatus" target="ocrMaritalStatus" />
          <zeebe:output source="=code" target="ocrStatusCode" />
          <zeebe:output source="=message" target="ocrMessage" />
          <zeebe:output source="=extra" target="ocrExtra" />
          <zeebe:output source="=transactionId" target="ocrTransactionId" />
          <zeebe:output source="=pricingStrategy" target="ocrPricingStrategy" />
          <zeebe:output source="=ocrBirthPlaceBirthdayList[1]" target="ocrBirthPlace" />
          <zeebe:output source="= split(substring(ocrBirthPlaceBirthdayList[2], 2), &#34;-&#34;)" target="ocrBirthDateList" />
          <zeebe:output source="= ocrBirthDateList[3] + &#34;-&#34; + ocrBirthDateList[2] + &#34;-&#34; + ocrBirthDateList[1]" target="ocrBirthDate" />
          <zeebe:output source="= kycRequestStatesList.WAITING_OCR_DATA" target="kycRequestState" />
          <zeebe:output source="= kycRequestMessagesList.WAITING_OCR_DATA" target="loanRequestMessage" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0negztp</bpmn:incoming>
      <bpmn:outgoing>Flow_1r1runz</bpmn:outgoing>
    </bpmn:receiveTask>
    <bpmn:boundaryEvent id="Event_01t4yjm" name="PT10M" attachedToRef="Activity_1xv0l7k">
      <bpmn:outgoing>Flow_1uq92tw</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_0zraeq6">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT10M</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
    <bpmn:serviceTask id="Activity_1deyr3t" name="Update status to &#34;OCR_DATA_&#10;COLLECTED&#34;">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="complete-type" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestStatesList.OCR_DATA_COLLECTED" target="kycRequestState" />
          <zeebe:output source="= loanRequestMessagesList.OCR_DATA_COLLECTED" target="loanRequestMessage" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0enkwii</bpmn:incoming>
      <bpmn:outgoing>Flow_1nct0gu</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_01k6irj" name="Generate Fail Message">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="variables-set-handler" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestMessagesList.GET_OCR_DATA_RESPONSE_EXPIRED" target="kycRequestMessage" />
          <zeebe:output source="= kycRequestStatesList.GET_OCR_DATA_RESPONSE_EXPIRED" target="kycRequestState" />
          <zeebe:output source="= workflowFailed" target="workflowFailed" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="variables-data" value="{&#34;workflowFailed&#34;:true}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1uq92tw</bpmn:incoming>
      <bpmn:outgoing>Flow_0g6dlse</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1nct0gu" sourceRef="Activity_1deyr3t" targetRef="Event_1hdrdqi" />
    <bpmn:sequenceFlow id="Flow_1uq92tw" sourceRef="Event_01t4yjm" targetRef="Activity_01k6irj" />
    <bpmn:sequenceFlow id="Flow_0g6dlse" sourceRef="Activity_01k6irj" targetRef="Event_1hdrdqi" />
    <bpmn:sequenceFlow id="Flow_0ewrx13" sourceRef="Event_1iz4017" targetRef="Activity_0klf8jq" />
    <bpmn:sequenceFlow id="Flow_10kn3dm" sourceRef="Event_1fnb9n2" targetRef="Activity_0klf8jq" />
    <bpmn:sequenceFlow id="Flow_1v6emu1" sourceRef="Activity_0klf8jq" targetRef="Event_1hdrdqi" />
    <bpmn:exclusiveGateway id="Gateway_14rtlcb" name="Success?">
      <bpmn:incoming>Flow_1r1runz</bpmn:incoming>
      <bpmn:outgoing>Flow_0enkwii</bpmn:outgoing>
      <bpmn:outgoing>Flow_06aywb3</bpmn:outgoing>
      <bpmn:outgoing>Flow_0bnqltd</bpmn:outgoing>
      <bpmn:outgoing>Flow_169ahwy</bpmn:outgoing>
      <bpmn:outgoing>Flow_1shq3l6</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0enkwii" name="Yes" sourceRef="Gateway_14rtlcb" targetRef="Activity_1deyr3t">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=ocrStatusCode = "SUCCESS"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_06aywb3" name="Service busy" sourceRef="Gateway_14rtlcb" targetRef="Activity_19kd86w">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=ocrStatusCode = "ERROR" or ocrStatusCode = "SERVICE_BUSY" or ocrStatusCode = "INSUFFICIENT_BALANCE" or ocrStatusCode = "OVER_QUERY_LIMIT"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:intermediateCatchEvent id="Event_0kb9pwq" name="PT1M">
      <bpmn:incoming>Flow_0qxxbpr</bpmn:incoming>
      <bpmn:outgoing>Flow_0k5xkm3</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_0vfjr42">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT1M</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>
    <bpmn:exclusiveGateway id="Gateway_1x6z9a8" default="Flow_0cmhw6r">
      <bpmn:incoming>Flow_1t67r37</bpmn:incoming>
      <bpmn:incoming>Flow_0k5xkm3</bpmn:incoming>
      <bpmn:outgoing>Flow_0cmhw6r</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1t67r37" sourceRef="Activity_12sr0ay" targetRef="Gateway_1x6z9a8" />
    <bpmn:sequenceFlow id="Flow_0k5xkm3" sourceRef="Event_0kb9pwq" targetRef="Gateway_1x6z9a8" />
    <bpmn:serviceTask id="Activity_08mqlef" name="Generate Fail Message">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="variables-set-handler" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestMessagesList.OCR_SERVICE_REQUEST_ERROR" target="kycRequestMessage" />
          <zeebe:output source="= kycRequestStatesList.OCR_SERVICE_REQUEST_ERROR" target="kycRequestState" />
          <zeebe:output source="= workflowFailed" target="workflowFailed" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="variables-data" value="{&#34;workflowFailed&#34;:true}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0bnqltd</bpmn:incoming>
      <bpmn:outgoing>Flow_1avo85z</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0bnqltd" name="Service error" sourceRef="Gateway_14rtlcb" targetRef="Activity_08mqlef">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=ocrStatusCode = "EMPTY_PARAMETER_ERROR" or ocrStatusCode = "PARAMETER_ERROR" or ocrStatusCode = "IAM_FAILED"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1avo85z" sourceRef="Activity_08mqlef" targetRef="Event_1hdrdqi" />
    <bpmn:sequenceFlow id="Flow_15okcgc" sourceRef="StartEvent_1" targetRef="Activity_1htx951" />
    <bpmn:sequenceFlow id="Flow_1a92wah" sourceRef="Activity_1htx951" targetRef="Activity_0o5g52b" />
    <bpmn:sequenceFlow id="Flow_0tuaryi" sourceRef="Activity_0o5g52b" targetRef="Gateway_1kbf9l8" />
    <bpmn:sequenceFlow id="Flow_0cmhw6r" sourceRef="Gateway_1x6z9a8" targetRef="Activity_1qmrwwt" />
    <bpmn:sequenceFlow id="Flow_0negztp" sourceRef="Activity_1qmrwwt" targetRef="Activity_1xv0l7k" />
    <bpmn:sequenceFlow id="Flow_1r1runz" sourceRef="Activity_1xv0l7k" targetRef="Gateway_14rtlcb" />
    <bpmn:serviceTask id="Activity_120xj3n" name="Generate Fail Message">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="variables-set-handler" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestMessagesList.OCR_FAILED_INVALID_IMAGE" target="kycRequestMessage" />
          <zeebe:output source="= kycRequestStatesList.OCR_FAILED_INVALID_IMAGE" target="kycRequestState" />
          <zeebe:output source="= workflowFailed" target="workflowFailed" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="variables-data" value="{&#34;workflowFailed&#34;:true}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_169ahwy</bpmn:incoming>
      <bpmn:outgoing>Flow_00ac2bd</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_169ahwy" name="Invalid format/size" sourceRef="Gateway_14rtlcb" targetRef="Activity_120xj3n">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=ocrStatusCode = "IMAGE_INVALID_FORMAT" or ocrStatusCode = "IMAGE_INVALID_SIZE"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_00ac2bd" sourceRef="Activity_120xj3n" targetRef="Event_1hdrdqi" />
    <bpmn:sequenceFlow id="Flow_1shq3l6" name="OCR no result" sourceRef="Gateway_14rtlcb" targetRef="Activity_111n4su">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=ocrStatusCode = "OCR_NO_RESULT"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_09g1wpu" sourceRef="Activity_111n4su" targetRef="Event_1hdrdqi" />
    <bpmn:serviceTask id="Activity_111n4su" name="Generate Fail Message">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="variables-set-handler" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestMessagesList.OCR_NO_RESULT" target="kycRequestMessage" />
          <zeebe:output source="= kycRequestStatesList.OCR_NO_RESULT" target="kycRequestState" />
          <zeebe:output source="= workflowFailed" target="workflowFailed" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="variables-data" value="{&#34;workflowFailed&#34;:true}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1shq3l6</bpmn:incoming>
      <bpmn:outgoing>Flow_09g1wpu</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_19kd86w" name="Update status to &#34;SERVICE_&#10;TEMPORARILY_UNAVAILABLE&#34;">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="complete-type" retries="1" />
        <zeebe:ioMapping>
          <zeebe:output source="= kycRequestStatesList.OCR_SEVICE_TEMPORARILY_UNAVAILABLE" target="kycRequestState" />
          <zeebe:output source="= kycRequestMessagesList.OCR_SEVICE_TEMPORARILY_UNAVAILABLE" target="loanRequestMessage" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_06aywb3</bpmn:incoming>
      <bpmn:outgoing>Flow_0qxxbpr</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0qxxbpr" sourceRef="Activity_19kd86w" targetRef="Event_0kb9pwq" />
    <bpmn:textAnnotation id="TextAnnotation_0vjbwli">
      <bpmn:text>если пользователь загрузил KTP невалидный по размеру или по формату, то будем ли просить загрузить заново?</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0o0umg1" sourceRef="Activity_120xj3n" targetRef="TextAnnotation_0vjbwli" />
    <bpmn:textAnnotation id="TextAnnotation_1z0dr4r">
      <bpmn:text>OCR check failed, unable to find any ktp field in the uploaded picture

Пользователь может загрузить вовсе не КТП</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0dyad07" sourceRef="Activity_111n4su" targetRef="TextAnnotation_1z0dr4r" />
  </bpmn:process>
  <bpmn:message id="Message_0mgx1fl" name="Message_ID_GET_PROFILE">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="customerId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_0id0zik" name="Message_ID_EMAIL_VERIFICATION_STATUS">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="customerId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_0c66i66" name="Message_DOCUMENT_EXISTENCE">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="customerId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_1ynv0n8" name="Message_ASA_PRO_DOC_UPLOAD_L2">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="workflowInstanceKey" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_064frh3" name="Message_OCR_DATA">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=customerId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="ocr-service">
      <bpmndi:BPMNEdge id="Flow_09g1wpu_di" bpmnElement="Flow_09g1wpu">
        <di:waypoint x="2080" y="690" />
        <di:waypoint x="2200" y="690" />
        <di:waypoint x="2200" y="140" />
        <di:waypoint x="2155" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1shq3l6_di" bpmnElement="Flow_1shq3l6">
        <di:waypoint x="1870" y="575" />
        <di:waypoint x="1870" y="690" />
        <di:waypoint x="1980" y="690" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1875" y="630" width="71" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_00ac2bd_di" bpmnElement="Flow_00ac2bd">
        <di:waypoint x="2079" y="430" />
        <di:waypoint x="2150" y="430" />
        <di:waypoint x="2150" y="165" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_169ahwy_di" bpmnElement="Flow_169ahwy">
        <di:waypoint x="1870" y="545" />
        <di:waypoint x="1870" y="430" />
        <di:waypoint x="1979" y="430" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1875" y="436" width="89" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1r1runz_di" bpmnElement="Flow_1r1runz">
        <di:waypoint x="1730" y="560" />
        <di:waypoint x="1835" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0negztp_di" bpmnElement="Flow_0negztp">
        <di:waypoint x="1540" y="560" />
        <di:waypoint x="1630" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0cmhw6r_di" bpmnElement="Flow_0cmhw6r">
        <di:waypoint x="1365" y="560" />
        <di:waypoint x="1440" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0tuaryi_di" bpmnElement="Flow_0tuaryi">
        <di:waypoint x="550" y="560" />
        <di:waypoint x="635" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1a92wah_di" bpmnElement="Flow_1a92wah">
        <di:waypoint x="360" y="560" />
        <di:waypoint x="450" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_15okcgc_di" bpmnElement="Flow_15okcgc">
        <di:waypoint x="188" y="560" />
        <di:waypoint x="260" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1avo85z_di" bpmnElement="Flow_1avo85z">
        <di:waypoint x="1900" y="310" />
        <di:waypoint x="2130" y="310" />
        <di:waypoint x="2130" y="165" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0bnqltd_di" bpmnElement="Flow_0bnqltd">
        <di:waypoint x="1850" y="545" />
        <di:waypoint x="1850" y="350" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1777" y="433" width="65" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0k5xkm3_di" bpmnElement="Flow_0k5xkm3">
        <di:waypoint x="1472" y="690" />
        <di:waypoint x="1340" y="690" />
        <di:waypoint x="1340" y="585" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1t67r37_di" bpmnElement="Flow_1t67r37">
        <di:waypoint x="1240" y="560" />
        <di:waypoint x="1315" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_06aywb3_di" bpmnElement="Flow_06aywb3">
        <di:waypoint x="1850" y="575" />
        <di:waypoint x="1850" y="690" />
        <di:waypoint x="1730" y="690" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1768" y="630" width="64" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0enkwii_di" bpmnElement="Flow_0enkwii">
        <di:waypoint x="1885" y="560" />
        <di:waypoint x="1979" y="560" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1911" y="542" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1v6emu1_di" bpmnElement="Flow_1v6emu1">
        <di:waypoint x="1070" y="110" />
        <di:waypoint x="2140" y="110" />
        <di:waypoint x="2140" y="132" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_10kn3dm_di" bpmnElement="Flow_10kn3dm">
        <di:waypoint x="1020" y="502" />
        <di:waypoint x="1020" y="150" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ewrx13_di" bpmnElement="Flow_0ewrx13">
        <di:waypoint x="520" y="502" />
        <di:waypoint x="520" y="110" />
        <di:waypoint x="970" y="110" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0g6dlse_di" bpmnElement="Flow_0g6dlse">
        <di:waypoint x="1700" y="170" />
        <di:waypoint x="1700" y="150" />
        <di:waypoint x="2122" y="150" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1uq92tw_di" bpmnElement="Flow_1uq92tw">
        <di:waypoint x="1700" y="502" />
        <di:waypoint x="1700" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1nct0gu_di" bpmnElement="Flow_1nct0gu">
        <di:waypoint x="2079" y="560" />
        <di:waypoint x="2180" y="560" />
        <di:waypoint x="2180" y="160" />
        <di:waypoint x="2155" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1r6aves_di" bpmnElement="Flow_1r6aves">
        <di:waypoint x="1050" y="560" />
        <di:waypoint x="1140" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_05bq5a6_di" bpmnElement="Flow_05bq5a6">
        <di:waypoint x="660" y="585" />
        <di:waypoint x="660" y="690" />
        <di:waypoint x="1190" y="690" />
        <di:waypoint x="1190" y="600" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="672" y="627" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_14kwi44_di" bpmnElement="Flow_14kwi44">
        <di:waypoint x="860" y="560" />
        <di:waypoint x="950" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0zp68gp_di" bpmnElement="Flow_0zp68gp">
        <di:waypoint x="685" y="560" />
        <di:waypoint x="760" y="560" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="701" y="542" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0qxxbpr_di" bpmnElement="Flow_0qxxbpr">
        <di:waypoint x="1630" y="690" />
        <di:waypoint x="1508" y="690" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="542" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1hdrdqi_di" bpmnElement="Event_1hdrdqi">
        <dc:Bounds x="2122" y="132" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1htx951_di" bpmnElement="Activity_1htx951">
        <dc:Bounds x="260" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0o5g52b_di" bpmnElement="Activity_0o5g52b">
        <dc:Bounds x="450" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1kbf9l8_di" bpmnElement="Gateway_1kbf9l8" isMarkerVisible="true">
        <dc:Bounds x="635" y="535" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="630" y="505" width="68" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0taxxf3_di" bpmnElement="Activity_0taxxf3">
        <dc:Bounds x="760" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0emeo0q_di" bpmnElement="Activity_0emeo0q">
        <dc:Bounds x="950" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_12sr0ay_di" bpmnElement="Activity_12sr0ay">
        <dc:Bounds x="1140" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0klf8jq_di" bpmnElement="Activity_0klf8jq">
        <dc:Bounds x="970" y="70" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1qmrwwt_di" bpmnElement="Activity_1qmrwwt">
        <dc:Bounds x="1440" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1xv0l7k_di" bpmnElement="Activity_1xv0l7k">
        <dc:Bounds x="1630" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_01k6irj_di" bpmnElement="Activity_01k6irj">
        <dc:Bounds x="1650" y="170" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_14rtlcb_di" bpmnElement="Gateway_14rtlcb" isMarkerVisible="true">
        <dc:Bounds x="1835" y="535" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1796" y="533" width="48" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1x6z9a8_di" bpmnElement="Gateway_1x6z9a8" isMarkerVisible="true">
        <dc:Bounds x="1315" y="535" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_08mqlef_di" bpmnElement="Activity_08mqlef">
        <dc:Bounds x="1800" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_120xj3n_di" bpmnElement="Activity_120xj3n">
        <dc:Bounds x="1979" y="390" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_111n4su_di" bpmnElement="Activity_111n4su">
        <dc:Bounds x="1980" y="650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0vjbwli_di" bpmnElement="TextAnnotation_0vjbwli">
        <dc:Bounds x="2220" y="520" width="99.99999794078421" height="151.99055330634278" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1z0dr4r_di" bpmnElement="TextAnnotation_1z0dr4r">
        <dc:Bounds x="1980" y="850" width="99.99999794078421" height="165.9919028340081" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0nhys0w_di" bpmnElement="Event_0kb9pwq">
        <dc:Bounds x="1472" y="672" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1475" y="715" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_19kd86w_di" bpmnElement="Activity_19kd86w">
        <dc:Bounds x="1630" y="650" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1deyr3t_di" bpmnElement="Activity_1deyr3t">
        <dc:Bounds x="1979" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_01t4yjm_di" bpmnElement="Event_01t4yjm">
        <dc:Bounds x="1682" y="502" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1722" y="503" width="36" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1fnb9n2_di" bpmnElement="Event_1fnb9n2">
        <dc:Bounds x="1002" y="502" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1033" y="493" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1iz4017_di" bpmnElement="Event_1iz4017">
        <dc:Bounds x="502" y="502" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="532" y="493" width="36" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_0o0umg1_di" bpmnElement="Association_0o0umg1">
        <di:waypoint x="2079" y="452" />
        <di:waypoint x="2236" y="520" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0dyad07_di" bpmnElement="Association_0dyad07">
        <di:waypoint x="2030" y="730" />
        <di:waypoint x="2030" y="850" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
